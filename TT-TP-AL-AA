-- Anti-Lag and Teleport LocalScript for Roblox
-- Place in StarterPlayerScripts

local RunService = game:GetService("RunService")
local UserGameSettings = UserSettings():GetService("UserGameSettings")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Function to optimize graphics settings (wrapped in pcall to avoid crashes)
local function optimizeGraphics()
	local success, err = pcall(function()
		UserGameSettings.SavedQualityLevel = Enum.SavedQualityLevel.QualityLevel1

		local lighting = game:GetService("Lighting")
		lighting.GlobalShadows = false
		lighting.FogEnd = 100000
		lighting.Brightness = 1
		lighting.Technology = Enum.Technology.Compatibility

		for _, obj in pairs(workspace:GetDescendants()) do
			if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Beam") then
				obj.Enabled = false
			elseif obj:IsA("Decal") then
				obj.Transparency = 1
			elseif obj:IsA("Sound") then
				obj.Volume = 0
			end
		end
	end)
	if not success then
		warn("optimizeGraphics failed: " .. err)
	end
end

-- Function to clean up unused objects
local function cleanupObjects()
	local success, err = pcall(function()
		for _, obj in pairs(workspace:GetDescendants()) do
			if obj:IsA("BasePart") and not obj.Anchored and obj.Parent then
				if obj.Position.Y < -500 or (obj.Position.Magnitude > 1000) then
					pcall(function() obj:Destroy() end)
				end
			elseif obj:IsA("Attachment") or obj:IsA("Weld") then
				if not obj.Parent:IsA("Humanoid") then
					pcall(function() obj:Destroy() end)
				end
			end
		end
	end)
	if not success then
		warn("cleanupObjects failed: " .. err)
	end
end

-- Function to reduce network load
local function optimizeNetwork()
	local success, err = pcall(function()
		RunService.RenderStepped:Connect(function()
			for _, player in pairs(Players:GetPlayers()) do
				if player ~= LocalPlayer and player.Character then
					local distance = (LocalPlayer.Character and LocalPlayer.Character.PrimaryPart and player.Character.PrimaryPart and (LocalPlayer.Character.PrimaryPart.Position - player.Character.PrimaryPart.Position).Magnitude) or math.huge
					if distance > 30 then
						for _, part in pairs(player.Character:GetChildren()) do
							if part:IsA("BasePart") then
								part.Transparency = 1
							end
						end
					end
				end
			end
		end)
	end)
	if not success then
		warn("optimizeNetwork failed: " .. err)
	end
end

-- Main function to run optimizations, teleport, and auto-jump
local function initialize(character)
	local success, err = pcall(function()
		local humanoidRootPart = character:WaitForChild("HumanoidRootPart", 5)
		local humanoid = character:WaitForChild("Humanoid", 5)

		if not humanoidRootPart or not humanoid then
			warn("Failed to find character components")
			return
		end

		-- Teleport to specified coordinates
		humanoidRootPart.CFrame = CFrame.new(Vector3.new(427.12786865234375, 131.3284149169922, 154.95379638671875))
		print("Teleported to specified coordinates")

		optimizeGraphics()
		optimizeNetwork()

		-- Periodically clean up objects
		task.spawn(function()
			while true do
				cleanupObjects()
				task.wait(30)
			end
		end)

		-- ðŸ”¹ Make the player jump every 5 seconds
		task.spawn(function()
			while character and character.Parent do
				task.wait(5)
				if humanoid and humanoid.Parent then
					humanoid.Jump = true
				end
			end
		end)
	end)
	if not success then
		warn("initialize failed: " .. err)
	end
end

-- Handle initial character and respawns
if LocalPlayer.Character then
	initialize(LocalPlayer.Character)
end
LocalPlayer.CharacterAdded:Connect(initialize)
